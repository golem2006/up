<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–†–∞–±–æ—Ç–∞ —Å –æ–±—ä–µ–∫—Ç–æ–º XMLHttpRequest</title>
    <style>
        body {
            padding: 0 100px;
        }
        form > * {
            display: block;
            margin-bottom: 10px;
        }
        textarea {
            resize: none;
        }
    </style>
</head>
<body>
    <h1>–ü—Ä.7 –†–∞–±–æ—Ç–∞ —Å –æ–±—ä–µ–∫—Ç–æ–º XMLHttpRequest</h1>
    <p>üîπ –ó–∞–¥–∞–Ω–∏–µ 1. –ë–∞–∑–æ–≤—ã–π GET-–∑–∞–ø—Ä–æ—Å</p>
    <pre id="out1">–ó–∞–≥—Ä—É–∑–∫–∞...</pre>
    <p>üîπ –ó–∞–¥–∞–Ω–∏–µ 2. POST-–∑–∞–ø—Ä–æ—Å —Å –æ—Ç–ø—Ä–∞–≤–∫–æ–π –¥–∞–Ω–Ω—ã—Ö</p>
    <form id="post-form">
        <input type="text" id="title" placeholder="–ó–∞–≥–æ–ª–æ–≤–æ–∫" required>
        <textarea type="text" id="body" placeholder="–°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ –ø–æ—Å—Ç–∞" required></textarea>
        <button type="submit">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
    </form>
    <pre id="out2"></pre>
    <script>
        // –ó–∞–¥–∞–Ω–∏–µ 1. –ë–∞–∑–æ–≤—ã–π GET-–∑–∞–ø—Ä–æ—Å
        const out1 = document.getElementById('out1');
        const out2 = document.getElementById('out2');
        const xhr = new XMLHttpRequest();
        xhr.open('GET', 'https://jsonplaceholder.typicode.com/posts/100', true);

        xhr.onload = function() {
          if (xhr.status === 200) {
            data = JSON.parse(xhr.responseText);
            console.log('–ó–∞–¥–∞–Ω–∏–µ 1:');
            console.log(data.title);
            out1.textContent = `–£—Å–ø–µ—à–Ω—ã–π –æ—Ç–≤–µ—Ç (–æ–±—ä–µ–∫—Ç js):

title: ${data.title}

body: ${data.body}

id: ${data.id}
                
userId: ${data.userId}
            `;
          } else {
            console.error('–û—à–∏–±–∫–∞:', xhr.status);
          }
        };

        xhr.onerror = function() {
          out1.textContent = '–ß—Ç–æ-—Ç–æ –ø–æ—à–ª–æ –Ω–µ —Ç–∞–∫';
          console.error('–û—à–∏–±–∫–∞ —Å–µ—Ç–∏');
        };

        xhr.send();

        // –ó–∞–¥–∞–Ω–∏–µ 2. POST-–∑–∞–ø—Ä–æ—Å —Å –æ—Ç–ø—Ä–∞–≤–∫–æ–π –¥–∞–Ω–Ω—ã—Ö
        document.getElementById('post-form').addEventListener('submit', (e) => {
            e.preventDefault();
            
            const xhr2 = new XMLHttpRequest();
            xhr2.open('POST', 'https://jsonplaceholder.typicode.com/posts', true);
            xhr2.setRequestHeader('Content-Type', 'application/json');
            xhr2.onload = function() {
              if (xhr2.status === 201) {
                out2.textContent = '–§–æ—Ä–º–∞ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞';
                console.log('–ó–∞–¥–∞–Ω–∏–µ 2:');
                console.log('–î–∞–Ω–Ω—ã–µ —É—Å–ø–µ—à–Ω–æ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω—ã:', xhr2.responseText);
              } else {
                out2.textContent = '–ß—Ç–æ-—Ç–æ –ø–æ—à–ª–æ –Ω–µ —Ç–∞–∫, –ø–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ';
              }
            };

            xhr2.onerror = function() {
                out2.textContent = '–ß—Ç–æ-—Ç–æ –ø–æ—à–ª–æ –Ω–µ —Ç–∞–∫, –ø–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ';
                console.error('–û—à–∏–±–∫–∞ —Å–µ—Ç–∏');
            };
        
            const data = {
              title: document.getElementById('title').value,
              body: document.getElementById('body').value,
              userId: 11234
            };
        
            xhr2.send(JSON.stringify(data));
        });

        // –ó–∞–¥–∞–Ω–∏–µ 3. –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è –∑–∞–ø—Ä–æ—Å–∞
        const xhr3 = new XMLHttpRequest();
        xhr3.open('GET', 'https://jsonplaceholder.typicode.com/posts/1', true);
        console.log('–ó–∞–¥–∞–Ω–∏–µ 3:');
        xhr3.onreadystatechange = function() {
          
          console.log(`–°–æ—Å—Ç–æ—è–Ω–∏–µ: ${xhr3.readyState}`);
        
          if (xhr3.readyState === 4) {
            if (xhr3.status === 200) {
              
              console.log('–ó–∞–ø—Ä–æ—Å –∑–∞–≤–µ—Ä—à–µ–Ω:', xhr3.responseText);
            } else {
              console.error('–û—à–∏–±–∫–∞:', xhr3.status);
            }
          }
        };

        xhr3.send();

        // –ó–∞–¥–∞–Ω–∏–µ 4. –°–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π vs –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π –∑–∞–ø—Ä–æ—Å
        console.log('–ó–∞–¥–∞–Ω–∏–µ 4:');
        // –°–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π –∑–∞–ø—Ä–æ—Å
        console.time('–°–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π');
        const syncXhr = new XMLHttpRequest();
        syncXhr.open('GET', 'https://jsonplaceholder.typicode.com/posts/1', false);
        syncXhr.send();
        console.timeEnd('–°–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π');

        // –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π –∑–∞–ø—Ä–æ—Å
        console.time('–ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π');
        const asyncXhr = new XMLHttpRequest();
        asyncXhr.open('GET', 'https://jsonplaceholder.typicode.com/posts/1', true);
        asyncXhr.onload = function() {
          console.timeEnd('–ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π');
        };
        asyncXhr.send();


    </script>
</body>
</html>